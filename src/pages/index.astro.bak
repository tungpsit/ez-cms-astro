import { getCollection } from "astro:content";
import SiteLayout from "../layouts/SiteLayout.astro";
import { formatDateString } from "../lib/cms/utils";
import { i18n } from "../lib/i18n";

const currentLocale = await i18n.getLocale(Astro.request);
const t = await i18n.getT(currentLocale);

const posts = await getCollection("posts", ({ data }) => !data.draft);
const sortedPosts = posts.sort(
  (a, b) =>
    new Date(b.data.publishDate).getTime() -
    new Date(a.data.publishDate).getTime(),
);
---

<SiteLayout>
  <section class="relative overflow-hidden">
    <div
      class="absolute inset-0 bg-gradient-to-br from-[var(--theme-primary)] opacity-10 via-transparent to-[var(--theme-accent)] opacity-10"
    >
    </div>
    <div
      class="absolute inset-0"
      style="background: radial-gradient(ellipse at top, rgba(var(--theme-primary-rgb), 0.1), transparent);"
    >
    </div>

    <div class="relative max-w-6xl mx-auto px-4 sm:px-6 py-24 md:py-32">
      <div class="text-center space-y-6 animate-fade-in">
        <div
          class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-emerald-500/10 border border-emerald-500/20 text-emerald-400 text-sm font-medium mb-4"
        >
          <svg
            class="w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13 10V3L4 14h7v7l9-11h-7z"></path>
          </svg>
          {t("Powered by Astro")}
        </div>

        <h1 class="text-4xl md:text-6xl lg:text-7xl font-bold">
          <span class="gradient-text">EZ CMS</span>
          <br />
          <span class="text-[var(--theme-text)]">{t("Content Made Simple")}</span>
        </h1>

        <p
          class="text-lg md:text-xl text-[var(--theme-text)] opacity-60 max-w-2xl mx-auto"
        >
          {t("A powerful, flexible content management system built with Astro. Create, customize, and manage your website with ease.")}
        </p>

        <div class="flex flex-wrap items-center justify-center gap-4 pt-4">
          <a href="/admin" class="btn btn-primary text-lg px-6 py-3">
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 10V3L4 14h7v7l9-11h-7z"></path>
            </svg>
            {t("Get Started")}
          </a>
          <a href="/blog" class="btn btn-secondary text-lg px-6 py-3">
            {t("Read Blog")}
          </a>
        </div>
      </div>
    </div>
  </section>

  <section class="max-w-6xl mx-auto px-4 sm:px-6 py-16">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div
        class="card group hover:border-[var(--theme-primary)] transition-colors"
      >
        <div
          class="w-12 h-12 rounded-xl bg-[rgba(var(--theme-primary-rgb),0.1)] flex items-center justify-center mb-4 group-hover:bg-[rgba(var(--theme-primary-rgb),0.2)] transition-colors"
        >
          <svg
            class="w-6 h-6 text-[var(--theme-primary)]"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"
            ></path>
          </svg>
        </div>
        <h3 class="text-lg font-semibold text-[var(--theme-text)] mb-2">
          {t("Customizable Themes")}
        </h3>
        <p class="text-[var(--theme-text)] opacity-60">
          {t("Choose from multiple themes or create your own. Full control over your site's appearance.")}
        </p>
      </div>

      <div
        class="card group hover:border-[var(--theme-accent)] transition-colors"
      >
        <div
          class="w-12 h-12 rounded-xl bg-[rgba(var(--theme-accent-rgb),0.1)] flex items-center justify-center mb-4 group-hover:bg-[rgba(var(--theme-accent-rgb),0.2)] transition-colors"
        >
          <svg
            class="w-6 h-6 text-[var(--theme-accent)]"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M17 14v6m-3-3h6M6 10h2a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2zm10 0h2a2 2 0 002-2V6a2 2 0 00-2-2h-2a2 2 0 00-2 2v2a2 2 0 002 2zM6 20h2a2 2 0 002-2v-2a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2z"
            ></path>
          </svg>
        </div>
        <h3 class="text-lg font-semibold text-[var(--theme-text)] mb-2">
          {t("Plugin System")}
        </h3>
        <p class="text-[var(--theme-text)] opacity-60">
          {t("Extend functionality with plugins. SEO, analytics, comments, and more.")}
        </p>
      </div>

      <div
        class="card group hover:border-[var(--theme-primary)] transition-colors"
      >
        <div
          class="w-12 h-12 rounded-xl bg-[rgba(var(--theme-primary-rgb),0.1)] flex items-center justify-center mb-4 group-hover:bg-[rgba(var(--theme-primary-rgb),0.2)] transition-colors"
        >
          <svg
            class="w-6 h-6 text-[var(--theme-primary)]"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13 10V3L4 14h7v7l9-11h-7z"></path>
          </svg>
        </div>
        <h3 class="text-lg font-semibold text-[var(--theme-text)] mb-2">
          {t("Lightning Fast")}
        </h3>
        <p class="text-[var(--theme-text)] opacity-60">
          {t("Static site generation with Astro for incredible performance and SEO.")}
        </p>
      </div>
    </div>
  </section>

  <section class="max-w-6xl mx-auto px-4 sm:px-6 py-16">
    <div class="flex items-center justify-between mb-8">
      <h2 class="text-2xl md:text-3xl font-bold text-[var(--theme-text)]">
        {t("Latest Posts")}
      </h2>
      <a href="/blog" class="btn btn-ghost text-sm">
        {t("View All")}
        <svg
          class="w-4 h-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
        </svg>
      </a>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      {
        sortedPosts.slice(0, 4).map((post, index) => (
          <a
            href={`/blog/${post.id}`}
            class="card group hover:border-[var(--theme-primary)] transition-all duration-300"
            style={`animation-delay: ${index * 100}ms`}
          >
            {post.data.featuredImage && (
              <div class="relative h-48 -mx-6 -mt-6 mb-4 overflow-hidden rounded-t-xl">
                <img
                  src={post.data.featuredImage}
                  alt={post.data.title}
                  class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                />
                <div class="absolute inset-0 bg-gradient-to-t from-[var(--theme-background)] opacity-80 to-transparent" />
              </div>
            )}

            <div class="flex items-center gap-2 mb-3">
              <span class="px-2.5 py-1 rounded-full bg-[rgba(var(--theme-primary-rgb),0.1)] text-[var(--theme-primary)] text-xs font-medium">
                {post.data.category}
              </span>
              <span class="text-[var(--theme-text)] opacity-40 text-sm">
                {formatDateString(post.data.publishDate)}
              </span>
            </div>

            <h3 class="text-lg font-semibold text-[var(--theme-text)] group-hover:text-[var(--theme-primary)] transition-colors mb-2">
              {post.data.title}
            </h3>

            {post.data.description && (
              <p class="text-[var(--theme-text)] opacity-60 text-sm line-clamp-2">
                {post.data.description}
              </p>
            )}
          </a>
        ))
      }
    </div>
  </section>

  <section class="max-w-6xl mx-auto px-4 sm:px-6 py-16">
    <div
      class="card bg-gradient-to-br from-[rgba(var(--theme-primary-rgb),0.1)] via-[var(--theme-card)] to-[rgba(var(--theme-accent-rgb),0.1)] border-[rgba(var(--theme-primary-rgb),0.2)] text-center py-12"
    >
      <h2 class="text-2xl md:text-3xl font-bold text-[var(--theme-text)] mb-4">
        {t("Ready to Get Started?")}
      </h2>
      <p class="text-[var(--theme-text)] opacity-60 mb-6 max-w-lg mx-auto">
        {t("Access the admin panel to create content, customize themes, and manage your website.")}
      </p>
      <a href="/admin" class="btn btn-primary text-lg px-8 py-3">
        {t("Open Admin Panel")}
      </a>
    </div>
  </section>
</SiteLayout>
